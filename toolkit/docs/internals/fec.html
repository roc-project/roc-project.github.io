
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Forward Erasure Correction codes &#8212; Roc Toolkit 0.1.5</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/roc.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="/analytics.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Frequency estimator and resampler" href="fe_resampler.html" />
    <link rel="prev" title="Data flow" href="data_flow.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="fe_resampler.html" title="Frequency estimator and resampler"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="data_flow.html" title="Data flow"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Roc Toolkit 0.1.5</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../internals.html" accesskey="U">Internals</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="forward-erasure-correction-codes">
<h1>Forward Erasure Correction codes<a class="headerlink" href="#forward-erasure-correction-codes" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of contents:</p>
<ul class="simple">
<li><a class="reference internal" href="#preface" id="id2">Preface</a></li>
<li><a class="reference internal" href="#rationale" id="id3">Rationale</a></li>
<li><a class="reference internal" href="#fecframe" id="id4">FECFRAME</a></li>
<li><a class="reference internal" href="#fec-packet-fields" id="id5">FEC packet fields</a></li>
<li><a class="reference internal" href="#sender" id="id6">Sender</a></li>
<li><a class="reference internal" href="#receiver" id="id7">Receiver</a></li>
</ul>
</div>
<div class="section" id="preface">
<h2><a class="toc-backref" href="#id2">Preface</a><a class="headerlink" href="#preface" title="Permalink to this headline">¶</a></h2>
<p>A network can be relatively reliable (e.g. Ethernet) or unreliable (e.g Wi-Fi or Internet). Unreliable networks require to use some techniques to recover lost data. Two known techniques are sending acknowledgments and retransmitting lost packets (like in TCP), and adding redundancy and then using it to restore lost packets (<a class="reference external" href="https://en.wikipedia.org/wiki/Erasure_code">Forward Erasure Correction codes</a>).</p>
<p>Roc counters packet losses by incorporating several Forward Erasure Correction codes.</p>
</div>
<div class="section" id="rationale">
<h2><a class="toc-backref" href="#id3">Rationale</a><a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h2>
<p>Why not just use TCP? The reason is that TCP can provide you with reliable transport, but can't guarantee a fixed latency and thus is not suitable for real-time streaming.</p>
<p>For real-time streaming, we usually use RTP, which is a UDP-based protocol. Bare RTP can provide you with a fixed latency, but it doesn't counter packet losses. At this step erasure detection and correction comes into play. It allows recovering some degree of lost packets while still maintaining a fixed latency.</p>
<p>FEC codes has the following advantages:</p>
<ul class="simple">
<li>the probability of packet delivery is increased;</li>
<li>the latency can still be fixed;</li>
</ul>
<p>and the following costs:</p>
<ul class="simple">
<li>the latency is increased (in proportion to the block size; see below);</li>
<li>the traffic is increased (in proportion to the redundancy level).</li>
</ul>
</div>
<div class="section" id="fecframe">
<h2><a class="toc-backref" href="#id4">FECFRAME</a><a class="headerlink" href="#fecframe" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://tools.ietf.org/html/rfc6363">RFC 6363</a> defines the FEC Framework (FECFRAME), a framework that describes how to use FEC codes with RTP in the network applications. FECFRAME does not provide 100% reliability like TCP does, it just increases the probability that the packet will be delivered, in proportion to the selected redundancy level.</p>
<p>FECFRAME specifies the <a class="reference external" href="https://tools.ietf.org/html/rfc6363#section-5">generic structure</a>
of source and repair packets, grouped into blocks. Source packets contain original data. Repair packets contain redundant data used for recovery. And blocks group the source packets with the corresponding repair packets which are protecting them.</p>
<p>For example, the sender can be configured to add 5 repair packets to every 10 source packets, thus forming blocks of 15 packets. This allows the receiver to recover up to 5 source packets if they get lost or delayed. On the other hand, using 10+5 blocks also requires the latency to be at least 10 packets because when a packet is lost at the beginning of the block, you may need all the remaining packets of this block to be able to recover the lost packet. It also increases the data rate in 1.5 (15/10) times.</p>
<p>FECFRAME doesn't define protocols and codecs by itself but instead allows different FEC schemes. An FEC scheme defines source and repair packet formats, FEC encoding (building the redundancy data), and decoding (repairing lost data).</p>
<p>Roc implements the FECFRAME specification with several FEC schemes. The packet level is implemented in Roc itself, and the codec level is implemented in <a class="reference external" href="http://openfec.org">OpenFEC library</a>. Currently, it's highly recommended to use <a class="reference external" href="https://github.com/roc-streaming/openfec">our fork</a> instead of the upstream version since it provides several bug fixes and minor improvements that are not available in the upstream yet.</p>
<p>Roc currently supports the following FEC schemes:</p>
<ul class="simple">
<li><a class="reference external" href="https://tools.ietf.org/html/rfc6865">Reed-Solomon</a>, suitable for smaller block sizes and latency (<a class="reference external" href="https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction">wikipedia</a>);</li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc6816">LDPC-Staircase</a>, suitable for larger block sizes and latency.</li>
</ul>
<p>FEC scheme implementations are encapsulated by an interface and new schemes can be added easily enough.</p>
</div>
<div class="section" id="fec-packet-fields">
<h2><a class="toc-backref" href="#id5">FEC packet fields</a><a class="headerlink" href="#fec-packet-fields" title="Permalink to this headline">¶</a></h2>
<p>The following fields are present in the source and repair packets:</p>
<ul class="simple">
<li>ESI(encoding symbol id) -- number of a packet (source or repair) in a block;</li>
<li>SBN(source block number) -- number of a source block in a packet stream;</li>
<li>SBL(source block length) -- number of source packets in a block;</li>
<li>BLEN(block length), or NEC(number encoding symbols) -- number of source and repair packets in a block.</li>
</ul>
</div>
<div class="section" id="sender">
<h2><a class="toc-backref" href="#id6">Sender</a><a class="headerlink" href="#sender" title="Permalink to this headline">¶</a></h2>
<p>The diagram below shows a piece of the sender pipeline responsible for FEC.</p>
<a class="reference internal image-reference" href="../_images/fec_writer_overview.png"><img alt="Writer overview" class="align-center" src="../_images/fec_writer_overview.png" style="width: 800px;" /></a>
<ul class="simple">
<li>writer works with the packets flow, cuts this flow into blocks;</li>
<li>writer passes contents of current block to encoder;</li>
<li>encoder produces the redundancy data;</li>
<li>writer builds repair packets from the redundancy data;</li>
<li>writer adds FEC packet fields to packets;</li>
<li>writer passes packets to composer;</li>
<li>composer writes FEC packet fields to the underlying packet payload;</li>
<li>writer passes packets to the further pipeline components.</li>
</ul>
<p>encoder and composer are encapsulated by an interface, implementations are chosen depending on the FEC scheme.</p>
</div>
<div class="section" id="receiver">
<h2><a class="toc-backref" href="#id7">Receiver</a><a class="headerlink" href="#receiver" title="Permalink to this headline">¶</a></h2>
<p>The diagram below shows a piece of the receiver pipeline responsible for FEC.</p>
<a class="reference internal image-reference" href="../_images/fec_reader_overview.png"><img alt="Reader overview" class="align-center" src="../_images/fec_reader_overview.png" style="width: 650px;" /></a>
<ul class="simple">
<li>reader works with the packets flow, cuts this flow into blocks;</li>
<li>if there are lost packets in the current block:<ul>
<li>reader passes contents of the current block to decoder;</li>
<li>decoder tries to recover lost packets;</li>
<li>reader passes the recovered packet data to parser;</li>
<li>parser builds the packet from the recovered data;</li>
</ul>
</li>
<li>reader passes packets to the further pipeline components.</li>
</ul>
<p>decoder and parser are encapsulated by an interface, implementations are chosen depending on the FEC scheme.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo80.png" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table of Contents</a></h3>
<p class="caption"><span class="caption-text">Table of Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about_project.html">About project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building.html">Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running.html">Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manuals.html">Manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../portability.html">Portability</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../internals.html">Internals</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_structure.html">Code structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_flow.html">Data flow</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Forward Erasure Correction codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="fe_resampler.html">Frequency estimator and resampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="network_protocols.html">Network protocols</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="fe_resampler.html" title="Frequency estimator and resampler"
             >next</a> |</li>
        <li class="right" >
          <a href="data_flow.html" title="Data flow"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Roc Toolkit 0.1.5</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../internals.html" >Internals</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Roc authors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>